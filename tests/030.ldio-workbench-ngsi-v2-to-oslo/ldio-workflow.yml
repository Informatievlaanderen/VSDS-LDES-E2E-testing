server:
  port: 8080
orchestrator:
  pipelines:
    - name: devices
      description: "Uses a HTTP listener accepting NGSI-v2 messages, converts them to NGSI-LD, and sends NGSI-LD version objects using HTTP to an LDES server."
      input:
        name: be.vlaanderen.informatievlaanderen.ldes.ldio.LdioHttpIn
        adapter:
          name: "be.vlaanderen.informatievlaanderen.ldes.ldi.NgsiV2ToLdAdapter"
          config:
            dataIdentifier: data
            coreContext: https://uri.etsi.org/ngsi-ld/v1/ngsi-ld-core-context-v1.6.jsonld
      transformers:
        - name: be.vlaanderen.informatievlaanderen.ldes.ldi.VersionObjectCreator
          config:
            member-type: https://uri.etsi.org/ngsi-ld/default-context/Device
            delimiter: "/"
            # date-observed-property: "[<https://uri.etsi.org/ngsi-ld/default-context/dateLastValueReported> <https://uri.etsi.org/ngsi-ld/hasValue>]"
            generatedAt-property: http://www.w3.org/ns/prov#generatedAtTime
            versionOf-property: http://purl.org/dc/terms/isVersionOf
      outputs:
        - name: be.vlaanderen.informatievlaanderen.ldes.ldio.LdioHttpOut
          config:
            endpoint: http://ldes-server:8080/devices
            content-type: application/n-quads
    - name: models
      description: "Uses a HTTP listener accepting NGSI-v2 messages, converts them to NGSI-LD, and sends NGSI-LD version objects using HTTP to an LDES server."
      input:
        name: be.vlaanderen.informatievlaanderen.ldes.ldio.LdioHttpIn
        adapter:
          name: "be.vlaanderen.informatievlaanderen.ldes.ldi.NgsiV2ToLdAdapter"
          config:
            dataIdentifier: data
            coreContext: https://uri.etsi.org/ngsi-ld/v1/ngsi-ld-core-context-v1.6.jsonld
      transformers:
        - name: be.vlaanderen.informatievlaanderen.ldes.ldi.VersionObjectCreator
          config:
            member-type: https://uri.etsi.org/ngsi-ld/default-context/DeviceModel
            delimiter: "/"
            date-observed-property: ""
            generatedAt-property: http://www.w3.org/ns/prov#generatedAtTime
            versionOf-property: http://purl.org/dc/terms/isVersionOf
      outputs:
        - name: be.vlaanderen.informatievlaanderen.ldes.ldio.LdioHttpOut
          config:
            endpoint: http://ldes-server:8080/device-models
            content-type: application/n-quads
    - name: observations
      description: "Uses a HTTP listener accepting NGSI-v2 messages, converts them to OSLO, and sends NGSI-LD version objects using HTTP to an LDES server."
      input:
        name: be.vlaanderen.informatievlaanderen.ldes.ldio.LdioHttpIn
        adapter:
          name: "be.vlaanderen.informatievlaanderen.ldes.ldi.NgsiV2ToLdAdapter"
          config:
            dataIdentifier: data
            coreContext: https://uri.etsi.org/ngsi-ld/v1/ngsi-ld-core-context-v1.6.jsonld
      transformers:
        - name: be.vlaanderen.informatievlaanderen.ldes.ldi.SparqlConstructTransformer
          config:
            query: |
              PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
              PREFIX sosa: <http://www.w3.org/ns/sosa/>
              PREFIX ngsiLdDC: <https://uri.etsi.org/ngsi-ld/default-context/>
              PREFIX ngsiLd: <https://uri.etsi.org/ngsi-ld/>
              CONSTRUCT {
                  ?wqo rdf:type <http://www.w3.org/ns/sosa/ObservationCollection> .
                  ?wqo <http://def.isotc211.org/iso19156/2011/SamplingFeature#SF_SamplingFeatureCollection.member> ?conductivity .
                  ?wqo <http://def.isotc211.org/iso19156/2011/SamplingFeature#SF_SamplingFeatureCollection.member> ?temperature .
                  ?wqo <http://def.isotc211.org/iso19156/2011/SamplingFeature#SF_SamplingFeatureCollection.member> ?batteryLevel .
                  ?wqo <http://def.isotc211.org/iso19156/2011/SamplingFeature#SF_SamplingFeatureCollection.member> ?location .
                  ?wqo sosa:phenomenonTime ?dateObserved .
                  ?batteryLevel <http://def.isotc211.org/iso19156/2011/Observation#OM_Observation.observedProperty> <https://data.vmm.be/concept/sensor/batterijniveau> .
                  ?batteryLevel <http://def.isotc211.org/iso19156/2011/Observation#OM_Observation.phenomenonTime> ?batteryLevelPhenomenonTime .
                  ?batteryLevel rdf:type <http://def.isotc211.org/iso19156/2011/Measurement#OM_Measurement> .
                  ?batteryLevel <http://www.w3.org/ns/sosa/madeBySensor> ?madeBySensor .
                  ?batteryLevel <http://def.isotc211.org/iso19156/2011/Observation#OM_Observation.result> [
                      <http://def.isotc211.org/iso19103/2005/UnitsOfMeasure#Measure.value> [
                          <https://schema.org/value> ?batteryLevelValue
                      ]
                  ] .
                  ?conductivity <http://def.isotc211.org/iso19156/2011/Observation#OM_Observation.observedProperty> <https://data.vmm.be/concept/waterkwaliteitparameter/conductiviteit> .
                  ?conductivity <http://def.isotc211.org/iso19156/2011/Observation#OM_Observation.phenomenonTime> ?conductivityPhenomenonTime .
                  ?conductivity rdf:type <http://def.isotc211.org/iso19156/2011/Measurement#OM_Measurement> .
                  ?conductivity <http://www.w3.org/ns/sosa/madeBySensor> ?madeBySensor .
                  ?conductivity <http://def.isotc211.org/iso19156/2011/Observation#OM_Observation.result> [
                      <http://def.isotc211.org/iso19103/2005/UnitsOfMeasure#Measure.value> [
                          <https://schema.org/value> ?conductivityValue
                      ]
                  ] .
                  ?depth <http://def.isotc211.org/iso19156/2011/Observation#OM_Observation.observedProperty> <https://data.vmm.be/concept/observatieparameter/hydrostatische-druk> .
                  ?depth <http://def.isotc211.org/iso19156/2011/Observation#OM_Observation.phenomenonTime> ?depthPhenomenonTime .
                  ?depth rdf:type <http://def.isotc211.org/iso19156/2011/Measurement#OM_Measurement> .
                  ?depth <http://www.w3.org/ns/sosa/madeBySensor> ?madeBySensor .
                  ?depth <http://def.isotc211.org/iso19156/2011/Observation#OM_Observation.result> [
                      <http://def.isotc211.org/iso19103/2005/UnitsOfMeasure#Measure.value> [
                          <https://schema.org/value> ?depthValue
                      ]
                  ] .
                  ?temperature <http://def.isotc211.org/iso19156/2011/Observation#OM_Observation.observedProperty> <https://data.vmm.be/concept/waterkwaliteitparameter/temperatuur> .
                  ?temperature <http://def.isotc211.org/iso19156/2011/Observation#OM_Observation.phenomenonTime> ?temperaturePhenomenonTime .
                  ?temperature rdf:type <http://def.isotc211.org/iso19156/2011/Measurement#OM_Measurement> .
                  ?temperature <http://www.w3.org/ns/sosa/madeBySensor> ?madeBySensor .
                  ?temperature <http://def.isotc211.org/iso19156/2011/Observation#OM_Observation.result> [
                      <http://def.isotc211.org/iso19103/2005/UnitsOfMeasure#Measure.value> [
                          <https://schema.org/value> ?temperatureValue
                      ]
                  ] .
                  ?location rdf:type <https://def.isotc211.org/iso19156/2011/SpatialSamplingFeature#SF_SpatialSamplingFeature> .
                  ?location rdf:asWkt ?locationWkt
              } WHERE {
                  ?wqo rdf:type <https://uri.etsi.org/ngsi-ld/default-context/WaterQualityObserved> .
                  ?wqo ngsiLdDC:dateObserved [
                      ngsiLd:hasValue ?dateObserved
                  ] .
                  ?wqo ngsiLdDC:refDevice ?refDevice .
                  ?refDevice <https://uri.etsi.org/ngsi-ld/hasObject> ?madeBySensor .
                  OPTIONAL {
                      ?wqo ngsiLdDC:batteryLevel ?batteryLevel .
                      ?batteryLevel <https://uri.etsi.org/ngsi-ld/observedAt> ?batteryLevelPhenomenonTime .
                      ?batteryLevel <https://uri.etsi.org/ngsi-ld/hasValue> ?batteryLevelValue .
                  }
              
                  OPTIONAL {
                      ?wqo ngsiLdDC:conductivity ?conductivity .
                      ?conductivity <https://uri.etsi.org/ngsi-ld/observedAt> ?conductivityPhenomenonTime .
                      ?conductivity <https://uri.etsi.org/ngsi-ld/hasValue> ?conductivityValue .
                  }
                  OPTIONAL {
                      ?wqo ngsiLdDC:depth ?depth .
                      ?depth <https://uri.etsi.org/ngsi-ld/observedAt> ?depthPhenomenonTime .
                      ?depth <https://uri.etsi.org/ngsi-ld/hasValue> ?depthValue .
                  }
                  OPTIONAL {
                      ?wqo ngsiLdDC:temperature ?temperature .
                      ?temperature <https://uri.etsi.org/ngsi-ld/observedAt> ?temperaturePhenomenonTime .
                      ?temperature <https://uri.etsi.org/ngsi-ld/hasValue> ?temperatureValue .
                  }
                  OPTIONAL {
                    ?wqo ngsiLd:location ?location .
                    ?location ngsiLdDC:asWkt ?locationWkt .
                  }
              }
        - name: be.vlaanderen.informatievlaanderen.ldes.ldi.VersionObjectCreator
          config:
            member-type: http://www.w3.org/ns/sosa/ObservationCollection
            delimiter: "/"
            date-observed-property: http://www.w3.org/ns/sosa/phenomenonTime
            generatedAt-property: http://www.w3.org/ns/prov#generatedAtTime
            versionOf-property: http://purl.org/dc/terms/isVersionOf
      outputs:
        - name: be.vlaanderen.informatievlaanderen.ldes.ldio.LdioHttpOut
          config:
            endpoint: http://ldes-server:8080/water-quality-observations
            content-type: application/n-quads
